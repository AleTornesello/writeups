from pwn import *
from binascii import hexlify
from string import printable

c = remote("crypto.2021.chall.actf.co", 21112)

BLOCK_SIZE = 16
FLAG_SIZE = 2 * BLOCK_SIZE - 7

flag = ""

for x in range(2*BLOCK_SIZE):
    c.recvuntil("give input: ", drop=True)
    c.sendline("00" * (2 * BLOCK_SIZE - x - 1) + "7b7d") #7b7d is the hex for {}
    decrypted = c.recvline().strip()
    decrypted_second_block = decrypted[2*BLOCK_SIZE:4*BLOCK_SIZE]

    for i in printable:
        i_hex = '{:02X}'.format(ord(i))

        c.recvuntil("give input: ", drop=True)
        payload = "00" * (2 * BLOCK_SIZE - x - 1) + \
            hexlify(flag.encode()).decode() + i_hex
        print(payload)
        c.sendline(payload)

        found = c.recvline().strip()
        found_second_block = found[2*BLOCK_SIZE:4*BLOCK_SIZE]

        if decrypted_second_block == found_second_block:
            flag += i
            print(flag)
            break
